/*! For license information please see main.48966c6c528c09b926cd.bundle.js.LICENSE.txt */
(()=>{var e,t={837:(e,t,s)=>{"use strict";s(260);class i extends Phaser.Scene{constructor(){super("BootScene")}preload(){this.load.image("bg","./assets/img/bg.jpg")}create(){this.scene.start("PreloadScene")}}class n{constructor(e){this.scene=e,this.init()}init(){this.createLoader(),this.createEvents()}createLoader(){this.width=500,this.height=50,this.offsetY=70,this.x=+this.scene.game.config.width/2-this.width/2,this.y=+this.scene.game.config.height-this.height/2-this.offsetY,this.back=this.scene.add.rectangle(this.x,this.y,this.width,this.height,0,.8).setOrigin(0),this.front=this.scene.add.rectangle(this.x,this.y,50,this.height,16777215,.8).setOrigin(0)}update(e){this.front.width=e*this.width}createEvents(){this.scene.load.on("progress",(e=>{this.update(e)})),this.scene.load.on("complete",(()=>{this.back.destroy(),this.front.destroy()}))}}class a extends Phaser.Scene{constructor(){super("PreloadScene")}preload(){this.add.image(0,0,"bg").setOrigin(0),this.load.image("o1","./assets/img/icons/o1.png"),this.load.image("o2","./assets/img/icons/o2.png"),this.load.image("o3","./assets/img/icons/o3.png"),this.load.image("x1","./assets/img/icons/x1.png"),this.load.image("x2","./assets/img/icons/x2.png"),this.load.image("x3","./assets/img/icons/x3.png"),this.load.audio("bg","./assets/audio/bg.ogg"),this.load.audio("click","./assets/audio/click.ogg"),this.load.audio("enter-o","./assets/audio/enter-o.ogg"),this.load.audio("enter-x","./assets/audio/enter-x.ogg"),this.load.audio("cells-adding","./assets/audio/cells-adding.ogg"),new n(this)}create(){this.sound.play("bg",{volume:.25,loop:!0}),this.time.addEvent({delay:2e3,callback:()=>{this.scene.start("StartScene")}})}}const c={default:{fontSize:"32px",fontFamily:"Palatino Linotype",fill:"#ffffff"}};c.menu=Object.assign(Object.assign({},c.default),{fill:"#333333"}),c.pulseHeader=Object.assign(Object.assign({},c.default),{fontSize:"48px"}),c.header=Object.assign(Object.assign({},c.default),{fontSize:"40px"}),c.text=Object.assign(Object.assign({},c.default),{fontSize:"26px",align:"center"});const l={STYLES:c,MENU:{offset:20,startY:360,bg:{color:16777215,width:400,height:50}},CONTENT:{header:{offsetY:80},text:{offsetY:150}},GAME:{count:3,size:70,cellBgColor:16777215,cellBgOpacity:.25,margin:5,angleFrom:-20,angleTo:20,duration:227,apperingDuration:227,addCellsPercent:70,addCellsTimes:2}},{STYLES:o,CONTENT:h}=l;class r{constructor(e){this.scene=e}addPulsingText(e,t={}){const s=this.scene.add.text(+this.scene.game.config.width/2,+this.scene.game.config.height/2,e,Object.assign(Object.assign({},o.pulseHeader),t)).setOrigin(.5);this.scene.tweens.add({targets:[s],duration:555,scale:1.25,repeat:-1,yoyo:!0})}createHeader(e){this.scene.add.text(+this.scene.game.config.width/2,h.header.offsetY,e,o.header).setOrigin(.5,0)}createDescription(e){this.scene.add.text(+this.scene.game.config.width/2,h.text.offsetY,e,o.text).setOrigin(.5,0)}}class d{constructor(e){this.scene=e,this.init()}init(){this.modals=document.querySelector("#modals")}drawBackground(e=0,t=.7){this.scene.add.image(0,0,"bg").setOrigin(0);const s=+this.scene.game.config.width,i=+this.scene.game.config.height;this.scene.add.rectangle(0,0,s,i,e,t).setOrigin(0)}showModal(e){this.closeModals(),this.modals.style.display="block",document.querySelector(e).style.display="block"}closeModals(){this.modals.style.display="none",Array.from(document.querySelectorAll(".js-modal-item")).forEach((e=>{e.style.display="none"}))}}class g extends Phaser.Scene{constructor(){super("StartScene"),this.helper=new d(this),this.content=new r(this)}create(){this.helper.drawBackground(),this.content.addPulsingText("Нажмите чтобы продолжить"),this.input.on("pointerdown",this.onTapDown,this)}onTapDown(){this.sound.play("click"),this.scene.start("MenuScene")}}const{STYLES:u,MENU:m}=l;class p{constructor(e){this.scene=e}create(e){this.backScene=e.backScene||"MenuScene",e.list.forEach(((t,s)=>{const i=(this.scene.game.config.width-m.bg.width)/2,n=m.startY+(m.bg.height+m.offset)*s+(+e.startY||0);this.createMenuItemBackground(t,i,n),this.createMenuItemText(t.label,n)})),this.scene.input.on("gameobjectdown",((t,s)=>{this.scene.sound.play("click"),(s.onClick||e.onClick||this.onClick.bind(this))(s.menu)}))}onClick(e){switch(e){case"pve":this.scene.scene.start("GameScene",{type:"pve"});break;case"pvp":this.scene.scene.start("RoomsScene");break;case"create-room":this.scene.scene.start("RoomScene");break;case"find-room":this.scene.scene.start("FindRoomScene");break;case"menu":this.scene.scene.start("MenuScene");break;case"back":this.scene.scene.start(this.backScene)}}createMenuItemBackground(e,t,s){e.rectangle=this.scene.add.rectangle(t,s,m.bg.width,m.bg.height,m.bg.color),e.rectangle.setInteractive(),e.rectangle.setOrigin(0),e.rectangle.menu=e.menu,e.rectangle.onClick=e.onClick}createMenuItemText(e,t){this.scene.add.text(+this.scene.game.config.width/2,t+m.bg.height/2,e,u.menu).setOrigin(.5)}}class y extends Phaser.Scene{constructor(){super("MenuScene"),this.helper=new d(this),this.menu=new p(this)}create(){this.helper.drawBackground(),this.menu.create({list:[{menu:"pve",label:"Играть с компьютером"},{menu:"pvp",label:"Играть с другом"}]})}}var b=s(794);const f=location.origin,w=(0,b.io)(f,{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),k=JSON.parse('{"o8":"CREATE_ROOM","d6":"REMOVE_ROOM","Wj":"ROOM_CREATED","kN":"WRONG_ROOM","xD":"ENTER_ROOM","s3":"INIT_GAME","Dz":"SET_SIGN","Q3":"ENEMY_LOSED","Z5":"SET_QUEUE"}');class O extends Phaser.Scene{constructor(){super("RoomsScene"),this.helper=new d(this),this.menu=new p(this)}init(){w.once(k.Wj,(e=>{console.log("room",e),this.scene.start("RoomScene",{room:e})}))}create(){this.helper.drawBackground(),this.menu.create({list:[{menu:"create-room",label:"Создать свою комнату",onClick:this.onCreateClick.bind(this)},{menu:"find-room",label:"Войти в комнату"},{menu:"back",label:"Назад"}],backScene:"MenuScene"})}onCreateClick(){console.log("onCreateClick"),w.emit(k.o8)}}class S extends Phaser.Scene{constructor(){super("FindRoomScene"),this.helper=new d(this)}init(){w.once(k.kN,this.onWrongRoom.bind(this)),w.once(k.s3,(e=>{this.scene.start("GameScene",{type:"pvp",data:e}),this.closeModal()}))}create(){var e,t;this.helper.drawBackground(),this.helper.showModal("#enter-room-id"),this.addEvents(),this.inputField=document.querySelector(".js-room-id-field"),null===(t=null===(e=this.inputField)||void 0===e?void 0:e.focus)||void 0===t||t.call(e)}addEvents(){this.closeButton=document.querySelector(".js-modals-close"),this.okButton=document.querySelector(".js-enter-room-btn"),this.closeButton.onclick=this.onCloseClick.bind(this),this.okButton.onclick=this.onOkClick.bind(this)}onCloseClick(){this.closeModal(),this.scene.start("RoomsScene")}onOkClick(){const e=parseInt(this.inputField.value);e?w.emit(k.xD,e):this.onWrongRoom()}onWrongRoom(){this.closeModal(),this.scene.start("MessageScene",{type:"wrong-room-id"})}closeModal(){this.sound.play("click"),this.inputField.value="",this.helper.closeModals()}}class C extends Phaser.Scene{constructor(){super("RoomScene"),this.content=new r(this),this.helper=new d(this),this.menu=new p(this)}init(){w.once(k.s3,(e=>{this.scene.start("GameScene",{type:"pvp",data:e})}))}create(e={}){this.params=e,this.helper.drawBackground(),this.content.createHeader(`ID комнаты: ${e.room.id}`),this.content.createDescription("Сообщите вашему сопернику ID вашей комнаты\nи начните играть вместе!\n\n\nОжидаем соперника..."),this.menu.create({list:[{menu:"back",label:"Назад",onClick:this.onBackClick.bind(this)}],backScene:"RoomsScene"})}onBackClick(){w.emit(k.d6,this.params.room.id),this.scene.start("RoomsScene")}}const{GAME:x}=l;class j{constructor(e){this.scene=e}create(e){this.params=e,this.cells=this.createEmptyCells(),this.winner="",this.addCellsTimes=x.addCellsTimes,this.fillCells(this.cells),this.addEvents()}addEvents(){this.params.onCellClick&&this.scene.input.on("gameobjectdown",this.params.onCellClick)}getFreeCells(){return this.getAllCells().filter((e=>!e.sign))}getAllCells(){return this.cells.reduce(((e,t)=>e.push(...t)&&e||[]),[])}getCellByCoords({row:e,col:t}){return this.getAllCells().find((s=>s.row===e&&s.col===t))}setSign(e,t){if(e.sign)return console.error("already set");this.scene.sound.play(`enter-${t}`,{volume:.5}),e.sign=t,e.cellSignObject=this.scene.add.image(e.cellObject.x+e.cellObject.width/2,e.cellObject.y+e.cellObject.height/2,this.getSignImageName(t)),e.cellSignObject.setOrigin(.5);const s=Math.max(e.cellSignObject.width,e.cellSignObject.height),i=x.size/s;e.cellSignObject.setScale(0),e.cellSignObject.setAngle(Phaser.Math.Between(x.angleFrom,x.angleTo)),this.scene.add.tween({scale:i,angle:0,targets:[e.cellSignObject],duration:x.duration}),this.checkWinner(this.cells),this.winner?this.scene.onWin(this.winner):this.checkCells()}checkCells(){const e=this.getFreeCells().length,t=Math.pow(this.cells.length,2)/100*(100-x.addCellsPercent);console.log(`freeCellsCount: ${e}, cellsMinimum: ${t}`),console.log("this.cells.length, 100, GAME.addCellsPercent",this.cells.length,100,x.addCellsPercent),t>e&&this.addCellsTimes&&(this.addCellsToEdges(),this.addCellsTimes-=1),e||this.scene.onFinish()}checkWinner(e){var t,s,i,n;this.winner="";let a={},c={};for(let l in e){const o=e[l];let h={},r={};for(let d in o){const g=o[d];r[null!==(t=g.sign)&&void 0!==t?t:""]=!0,h[null!==(s=e[d][l].sign)&&void 0!==s?s:""]=!0,l===d&&(a[null!==(i=g.sign)&&void 0!==i?i:""]=!0),o.length-1-+l==+d&&(c[null!==(n=g.sign)&&void 0!==n?n:""]=!0)}const d=Object.keys(r);if(1===d.length&&d[0]){this.winner=d[0];break}const g=Object.keys(h);if(!this.winner&&1===g.length&&g[0]){this.winner=g[0];break}}const l=Object.keys(a);!this.winner&&1===l.length&&l[0]&&(this.winner=l[0]);const o=Object.keys(c);return!this.winner&&1===o.length&&o[0]&&(this.winner=o[0]),this.winner}getSignImageName(e){return e+String(Phaser.Math.Between(1,3))}createEmptyCells(){return this.getNewEmptyArr(x.count).map(((e,t)=>this.getNewEmptyArr(x.count).map(((e,s)=>Object.assign(Object.assign({},this.getColumnsTemplate()),{row:t,col:s})))))}fillCells(e){const t=x.size,s=x.margin,i=e.length*(t+s)-s,n=(+this.scene.game.config.width-i)/2,a=(+this.scene.game.config.height-i)/2;e.forEach(((e,i)=>{e.forEach(((e,c)=>{if(e.cellObject)return;const l={x:+this.scene.game.config.width/2-t/2,y:+this.scene.game.config.height/2-t/2},o={x:c*(t+s)+n,y:i*(t+s)+a};e.cellObject=this.scene.add.rectangle(l.x,l.y,t,t,x.cellBgColor,x.cellBgOpacity).setOrigin(0),this.scene.add.tween(Object.assign(Object.assign({},o),{targets:[e.cellObject],duration:x.apperingDuration+0*x.apperingDuration})),e.cellObject.setInteractive(),e.cellObject.cell=e}))}))}addCellsToEdges(){this.scene.sound.play("cells-adding");const e=this.cells.length;this.cells.unshift(this.getNewEmptyArr(e)),this.cells.push(this.getNewEmptyArr(e)),this.cells[0]=this.cells[0].map(((e,t)=>Object.assign(Object.assign({},this.getColumnsTemplate()),{row:this.cells[1][0].row-1,col:t}))),this.cells[this.cells.length-1]=this.cells[this.cells.length-1].map(((e,t)=>Object.assign(Object.assign({},this.getColumnsTemplate()),{row:this.cells[this.cells.length-2][0].row+1,col:t}))),this.cells.forEach((e=>{e.unshift(Object.assign(Object.assign({},this.getColumnsTemplate()),{row:e[0].row,col:e[0].col-1})),e.push(Object.assign(Object.assign({},this.getColumnsTemplate()),{row:e[0].row,col:e[e.length-1].col+1}))})),this.fillCells(this.cells)}getColumnsTemplate(){return{sign:"",row:void 0,col:void 0,cellObject:null}}getNewEmptyArr(e){return new Array(e).fill(null)}}class E{constructor(e){this.scene=e,this.init()}init(){this.addInfoBox(),this.queueTextObj=this.scene.add.text(20,20,"",{color:"#000",fontSize:"20px"}),this.updateQueue()}addInfoBox(){this.scene.add.rectangle(0,0,420,110,16777215,.75)}updateQueue(){this.queueTextObj.setText(`Ход: ${this.getQueueLabel(this.scene.queueId)}`)}getQueueLabel(e){return{[this.scene.enemy.id]:"Противника",[this.scene.player.id]:"Ваш"}[e]||""}}const{GAME:v}=l;class P{constructor(e){this.isBot=!1,this.scene=e}botWalk(){const e=Phaser.Math.Between(500,2e3);this.scene.time.addEvent({delay:e,callback:this.botWalkHandler,callbackScope:this})}botWalkHandler(){const e=this.scene.cells.getFreeCells();if(e.length){const t=e[Phaser.Math.Between(0,e.length-1)];this.scene.canBotPass(t)&&(this.scene.cells.setSign(t,this.sign),this.scene.setQueueToPlayer())}}}const{GAME:T}=l;class M extends Phaser.Scene{constructor(){super("GameScene")}init(){w.on(k.Dz,this.onEnemyPassed.bind(this)),w.on(k.Z5,this.onSetQueue.bind(this)),w.once(k.Q3,this.onEnemyLosed.bind(this))}onEnemyPassed(e){console.log("onEnemyPassed: coords",e);const t=this.cells.getCellByCoords(e);console.log("cell",t),t&&(this.cells.setSign(t,this.enemy.sign),this.setQueueToPlayer())}onSetQueue(e){this.setQueue(e)}create(e={}){this.params=e,this.helper=new d(this),this.helper.drawBackground(),this.cells=new j(this),this.cells.create({onCellClick:this.onCellClick.bind(this)}),this.initPlayers(),this.infoBox=new E(this),this.infoBox.updateQueue(),this.start()}initPlayers(){if(this.player=new P(this),this.enemy=new P(this),this.winnerId="",this.queueId="","pve"==this.params.type){this.enemy.isBot=!0,this.enemy.id="enemy",this.player.id="player";const e=["x","o"];this.player.sign=e.splice(Phaser.Math.Between(0,1),1)[0],this.enemy.sign=e[0],this.queueId=[this.enemy.id,this.player.id][Phaser.Math.Between(0,1)]}"pvp"==this.params.type&&(this.enemy.isBot=!1,this.roomId=this.params.data.id,this.enemy.id=this.params.data.enemyId,this.player.id=this.params.data.playerId,this.enemy.sign=this.params.data.players.find((e=>e.socketId!=this.player.id)).sign,this.player.sign=this.params.data.players.find((e=>e.socketId!=this.enemy.id)).sign,this.queueId=this.params.data.queueId)}start(){this.enemy.isBot&&this.queueId==this.enemy.id&&this.enemy.botWalk()}onWin(e){this.winnerId=this.player.sign===e?this.player.id:this.enemy.id,this.finish(this.player.sign===e?"player-win":"enemy-win")}onFinish(){this.finish()}onEnemyLosed(){this.finish("enemy-losed")}finish(e="game-finished"){w.emit(k.d6,this.roomId),this.time.addEvent({delay:T.duration,callback:()=>{this.scene.start("MessageScene",{type:e})}})}hasWinner(){return!!this.winnerId}onCellClick(e,t){this.canPlayerPass(t.cell)&&(this.enemy.isBot||w.emit(k.Dz,{enemyId:this.enemy.id,coords:{row:t.cell.row,col:t.cell.col}}),this.cells.setSign(t.cell,this.player.sign),this.setQueueToEnemy())}canPlayerPass(e){return this.canPass(this.player.id,e)}canBotPass(e){return this.canPass(this.enemy.id,e)}canPass(e,t){return this.queueId===e&&!t.sign&&!this.hasWinner()}setQueueToEnemy(){this.setQueue(this.enemy.id),this.enemy.isBot?this.enemy.botWalk():w.emit(k.Z5,this.enemy.id)}setQueueToPlayer(){this.setQueue(this.player.id)}setQueue(e){if(this.hasWinner())return console.error("has winner...");this.queueId=e,this.infoBox.updateQueue()}}class B extends Phaser.Scene{constructor(){super("MessageScene"),this.content=new r(this),this.helper=new d(this),this.menu=new p(this)}create(e){this.helper.drawBackground();const t={"wrong-room-id":{header:"Не правильный ID",text:"Вы ввели не правильный или не существующий ID комнаты\nПопробуйте, пожалуйста, еще раз!",list:[{menu:"find-room",label:"Попробовать еще"},{menu:"menu",label:"На главную"}]},"game-finished":{header:"Ничья",text:"Все клетки на поле заполнены.\nНе переживайте, в следующий раз у вас обязательно все получится!",list:[{menu:"menu",label:"На главную"}]},"enemy-win":{header:"Вы проиграли",text:"Увы, но в этот раз выиграл ваш соперник.\nНе переживайте, в следующий раз у вас обязательно все получится!",list:[{menu:"menu",label:"На главную"}]},"player-win":{header:"Вы выиграли",text:"Поздравляем!\nВы одержали победу на вашим соперником!",list:[{menu:"menu",label:"На главную"}]},"enemy-losed":{header:"Упс...",text:"Ваш соперник вышел.\nПопробуйте поиграть с кем-нибудь другим",list:[{menu:"menu",label:"На главную"}]}};this.content.createHeader(t[e.type].header),this.content.createDescription(t[e.type].text),this.menu.create({list:t[e.type].list})}}const I={type:Phaser.AUTO,transparent:!0,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},width:1280,height:720,scene:[i,a,g,y,O,S,C,M,B]};new Phaser.Game(I)},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var n=s[e];if(void 0!==n)return n.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,n,a)=>{if(!s){var c=1/0;for(r=0;r<e.length;r++){for(var[s,n,a]=e[r],l=!0,o=0;o<s.length;o++)(!1&a||c>=a)&&Object.keys(i.O).every((e=>i.O[e](s[o])))?s.splice(o--,1):(l=!1,a<c&&(c=a));if(l){e.splice(r--,1);var h=n();void 0!==h&&(t=h)}}return t}a=a||0;for(var r=e.length;r>0&&e[r-1][2]>a;r--)e[r]=e[r-1];e[r]=[s,n,a]},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var n,a,[c,l,o]=s,h=0;if(c.some((t=>0!==e[t]))){for(n in l)i.o(l,n)&&(i.m[n]=l[n]);if(o)var r=o(i)}for(t&&t(s);h<c.length;h++)a=c[h],i.o(e,a)&&e[a]&&e[a][0](),e[c[h]]=0;return i.O(r)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(837)));var n=i.O(void 0,[216],(()=>i(204)));n=i.O(n)})();